# Фаза 4-5: Кастомные плагины и демо-контент

## Описание

Комплексное тестирование автоматического копирования ACF полей и таксономий при создании переводов постов через Polylang.

## Структура (57 тестов)

- **Блок A** (4 теста) — Подготовка окружения
- **Блок B** (10 тестов) — Автосоздание терминов с переводами
- **Блок C** (11 тестов) — Тестирование CPT artist
- **Блок D** (9 тестов) — Тестирование CPT collection
- **Блок E** (7 тестов) — Тестирование CPT events
- **Блок F** (6 тестов) — Тестирование CPT vistavki
- **Блок G** (4 теста) — Анализ покрытия переводов таксономий
- **Блок H** (4 теста) — Дополнительные тесты редиректов
- **Блок I** (2 теста) — Очистка тестовых данных

## Запуск

```bash
# Запуск фазы 4-5
./polylang-test.sh --env=local --only=4

# С сохранением лога
./polylang-test.sh --env=local --only=4 2>&1 | tee phase-4-5.log
```

## Интерактивные шаги

Тесты требуют ручного создания EN переводов для проверки работы mu-plugin:

1. Браузер откроется автоматически на странице редактирования RU поста
2. В блоке Languages (справа) нажмите "+ EN"
3. В новом окне нажмите "Опубликовать" (ACF поля скопируются автоматически)
4. Вернитесь в терминал и нажмите Enter

## Проверяемая функциональность

✅ **mu-plugin maslovka-polylang-acf.php:**
- Автоматическое копирование ACF полей при создании перевода
- Копирование связей таксономий с автоматическим переводом терминов
- Защита от перезаписи оригинальных значений
- Копирование галерей изображений

✅ **Интеграция с Redirection:**
- Создание редиректов при изменении слага
- Удаление редиректов при удалении поста

✅ **Анализ качества переводов:**
- Покрытие переводов для всех 9 таксономий
- TOP-10 непереведённых терминов
- Рекомендации по улучшению

## Реальные данные проекта

Используются реальные ACF поля и таксономии из плагина `maslovka-custom-fields`:

### CPT и поля:
- **artist**: first_name, patronymic, birth_date, death_date, работы_художника, фото_художника
- **collection**: artist_id, year_created, current_location, status, height, width, depth
- **events**: ссылка_для_кнопки, текст_в_кнопке, цвет_блока, дата_начала, дата, цвет_текста_события
- **vistavki**: описание_мероприятия, ссылка_купить, текст_в_кнопке, Картинка_выставки, дата_проведения_начало, дата_окончание, фото_выставки

### Таксономии:
- art_form, period, genres, styles (artist + collection)
- techniques, materials (collection)
- artist_group, education (artist)
- event_types (events)

## Архитектура

```
phase-4-5.sh              Главный оркестратор
phase-4-5/
├── common.sh             Общие данные и функции
├── block-a-preparation.sh
├── block-b-terms.sh
├── block-c-artist.sh
├── block-d-collection.sh
├── block-e-events.sh
├── block-f-vistavki.sh
├── block-g-coverage.sh
├── block-h-redirects.sh
└── block-i-cleanup.sh
```

## Требования

- WP-CLI (для создания тестовых постов/терминов)
- mu-plugin `maslovka-polylang-acf.php` установлен
- Минимум 3 изображения в медиабиблиотеке
- Браузер (для интерактивных проверок)
