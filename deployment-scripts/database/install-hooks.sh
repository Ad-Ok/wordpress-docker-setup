#!/bin/bash
# ๐ง Installer for Git Hooks
# ะฃััะฐะฝะพะฒะบะฐ Git hooks ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ัะฟัะฐะฒะปะตะฝะธั ะะ

set -e

# ะฆะฒะตัะฐ
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m'

# ะะพะปััะธัั ะดะธัะตะบัะพัะธั ะฟัะพะตะบัะฐ
PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/../.." && pwd)"
GIT_HOOKS_DIR="${PROJECT_ROOT}/.git/hooks"
SOURCE_HOOKS_DIR="${PROJECT_ROOT}/www/deployment-scripts/database/git-hooks"

echo -e "${BLUE}๐ง ะฃััะฐะฝะพะฒะบะฐ Git Hooks${NC}\n"

# ะัะพะฒะตัะธัั, ััะพ ะผั ะฒ Git ัะตะฟะพะทะธัะพัะธะธ
if [ ! -d "${PROJECT_ROOT}/.git" ]; then
    echo -e "${RED}โ ะญัะพ ะฝะต Git ัะตะฟะพะทะธัะพัะธะน${NC}"
    exit 1
fi

# ะกะพะทะดะฐัั ะดะธัะตะบัะพัะธั hooks ะตัะปะธ ะฝะต ัััะตััะฒัะตั
mkdir -p "${GIT_HOOKS_DIR}"

# ะฃััะฐะฝะพะฒะธัั post-checkout hook
echo -e "${CYAN}โ ะฃััะฐะฝะพะฒะบะฐ post-checkout hook...${NC}"

if [ -f "${GIT_HOOKS_DIR}/post-checkout" ]; then
    echo -e "${YELLOW}   โ๏ธ  ะคะฐะนะป ัะถะต ัััะตััะฒัะตั. ะกะพะทะดะฐั backup...${NC}"
    cp "${GIT_HOOKS_DIR}/post-checkout" "${GIT_HOOKS_DIR}/post-checkout.backup.$(date +%Y%m%d_%H%M%S)"
fi

# ะกะพะทะดะฐัั ัะธะผะฒะพะปะธัะตัะบัั ัััะปะบั
ln -sf "${SOURCE_HOOKS_DIR}/post-checkout" "${GIT_HOOKS_DIR}/post-checkout"
chmod +x "${GIT_HOOKS_DIR}/post-checkout"

echo -e "${GREEN}โ Hook ัััะฐะฝะพะฒะปะตะฝ${NC}"

# ะะฝัะพัะผะฐัะธั
echo -e "\n${BLUE}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${GREEN}โ Git hooks ััะฟะตัะฝะพ ัััะฐะฝะพะฒะปะตะฝั!${NC}"
echo -e "${BLUE}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}\n"

echo -e "${YELLOW}ะงัะพ ััะพ ะดะฐะตั:${NC}"
echo -e "  โข ะะฒัะพะผะฐัะธัะตัะบะพะต ัะพััะฐะฝะตะฝะธะต ะะ ะฟัะธ ะฟะตัะตะบะปััะตะฝะธะธ ะฒะตัะพะบ"
echo -e "  โข ะะฒัะพะผะฐัะธัะตัะบะพะต ะฒะพัััะฐะฝะพะฒะปะตะฝะธะต ะะ ะดะปั ะฝะพะฒะพะน ะฒะตัะบะธ"
echo -e "  โข ะะทะพะปััะธั ะะ ะผะตะถะดั ะฒะตัะบะฐะผะธ\n"

echo -e "${CYAN}ะะฐะบ ัะฐะฑะพัะฐะตั:${NC}"
echo -e "  1. git checkout feature/blog"
echo -e "     โ ะกะพััะฐะฝัะตััั ะะ ัะตะบััะตะน ะฒะตัะบะธ"
echo -e "     โ ะะพัััะฐะฝะฐะฒะปะธะฒะฐะตััั ะะ ะดะปั feature/blog"
echo -e "  2. ะะฐะฑะพัะฐะตัะต ะฝะฐะด ัะธัะตะน"
echo -e "  3. git checkout main"
echo -e "     โ ะกะฝะพะฒะฐ ะฐะฒัะพะผะฐัะธัะตัะบะพะต ะฟะตัะตะบะปััะตะฝะธะต ะะ\n"

echo -e "${YELLOW}ะฃะฟัะฐะฒะปะตะฝะธะต:${NC}"
echo -e "  โข ะะบะปััะธัั/ะฒัะบะปััะธัั ะฒ config.sh:"
echo -e "    ${CYAN}SNAPSHOT_AUTO_SWITCH=\"true\"${NC} ะธะปะธ ${CYAN}\"false\"${NC}"
echo -e "  โข ะัััะฝัั: ${CYAN}./db-snapshot.sh restore <snapshot>${NC}\n"

echo -e "${GREEN}ะะพัะพะฒะพ! ะขะตะฟะตัั ะะ ะฑัะดะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะตัะตะบะปััะฐัััั ะฟัะธ checkout.${NC}\n"
