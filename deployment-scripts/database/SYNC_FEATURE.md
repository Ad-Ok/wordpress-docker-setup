# üîÑ –ü—Ä—è–º–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏

## –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è: `db-sync.sh sync`

–¢–µ–ø–µ—Ä—å —Å–∫—Ä–∏–ø—Ç `db-sync.sh` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–ø—Ä—è–º—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é** –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —É–¥–∞–ª–µ–Ω–Ω—ã–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏ (PROD ‚Üî DEV) –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É –∫–∞–∫ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –∑–≤–µ–Ω–æ.

---

## ‚≠ê –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. PROD ‚Üí DEV (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
./db-sync.sh sync prod dev
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- üîÑ –û–±–Ω–æ–≤–∏—Ç—å DEV –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ PROD –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- üß™ –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- üêõ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –±–∞–≥ —Å –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –Ω–∞ DEV
- üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### 2. DEV ‚Üí PROD (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
```bash
./db-sync.sh sync dev prod
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- üöÄ –ü–µ—Ä–µ–Ω–æ—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å DEV –Ω–∞ PROD
- üÜï Initial deploy –Ω–æ–≤–æ–≥–æ —Å–∞–π—Ç–∞
- ‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï**: –¢—Ä–µ–±—É–µ—Ç –≤–≤–µ—Å—Ç–∏ `REPLACE DATABASE` –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è!

---

## üîß –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç

1. **–°–æ–∑–¥–∞–µ—Ç backup** –Ω–∞ —Ü–µ–ª–µ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ
2. **–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –ë–î** —Å —Å–µ—Ä–≤–µ—Ä–∞-–∏—Å—Ç–æ—á–Ω–∏–∫–∞ (—á–µ—Ä–µ–∑ WP-CLI)
3. **–ü–µ—Ä–µ–¥–∞–µ—Ç —á–µ—Ä–µ–∑ pipe** –Ω–∞ —Ü–µ–ª–µ–≤–æ–π —Å–µ—Ä–≤–µ—Ä
4. **–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –ë–î** –Ω–∞ —Ü–µ–ª–µ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ
5. **–ó–∞–º–µ–Ω—è–µ—Ç –¥–æ–º–µ–Ω—ã** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (search-replace)
6. **–û—á–∏—â–∞–µ—Ç –∫—ç—à** WordPress

---

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –î–ª—è DEV
- –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ `yes/no`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç backup –ø–µ—Ä–µ–¥ –∑–∞–º–µ–Ω–æ–π

### –î–ª—è PROD
- –¢—Ä–µ–±—É–µ—Ç –≤–≤–µ—Å—Ç–∏ `REPLACE DATABASE` (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç backup –≤ `../backups/`
- Backup —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å –º–µ—Ç–∫–æ–π –≤—Ä–µ–º–µ–Ω–∏ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–±–Ω–æ–≤–∏—Ç—å DEV –∏–∑ PROD
```bash
cd www/deployment-scripts/database
./db-sync.sh sync prod dev
# –í–≤–æ–¥–∏–º: yes
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- DEV –ø–æ–ª—É—á–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ PROD
- –î–æ–º–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–Ω—è—Ç—Å—è –Ω–∞ DEV URL
- Backup —Å–æ–∑–¥–∞–Ω: `backup-before-sync-from-prod-TIMESTAMP.sql.gz`

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –≤–∞–∂–Ω—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
```bash
# 1. –û–±–Ω–æ–≤–∏—Ç—å DEV –∏–∑ PROD
./db-sync.sh sync prod dev

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ DEV
./db-migrate.sh apply dev

# 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
# ...

# 4. –ï—Å–ª–∏ –≤—Å–µ –û–ö - –ø—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞ PROD
./db-migrate.sh apply prod
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–≥–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```bash
# –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–¥–∞–∫—à–µ–Ω –Ω–∞ DEV
./db-sync.sh sync prod dev

# –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –±–∞–≥ –Ω–∞ DEV
# ...

# –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ DEV
# ...

# –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å —Ñ–∏–∫—Å –Ω–∞ PROD
```

---

## üîÑ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤

### –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± (—á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É)
```bash
# –®–∞–≥ 1: –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å PROD –Ω–∞ local
./db-sync.sh pull prod

# –®–∞–≥ 2: –í—Ä—É—á–Ω—É—é –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞ DEV
scp /tmp/dump.sql.gz user@dev:/tmp/
ssh user@dev "wp db import /tmp/dump.sql.gz"
ssh user@dev "wp search-replace prod.url dev.url"
```

**–ú–∏–Ω—É—Å—ã:**
- –¢—Ä–µ–±—É–µ—Ç 3 –∫–æ–º–∞–Ω–¥—ã
- –î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É (–º–µ–¥–ª–µ–Ω–Ω–æ)
- –ó–∞–Ω–∏–º–∞–µ—Ç –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ –ª–æ–∫–∞–ª—å–Ω–æ
- –ù—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –¥–µ–ª–∞—Ç—å search-replace

### –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–± (–ø—Ä—è–º–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)
```bash
./db-sync.sh sync prod dev
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞
- ‚úÖ –ü—Ä—è–º–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏ (–±—ã—Å—Ç—Ä–æ)
- ‚úÖ –ù–µ –∑–∞–Ω–∏–º–∞–µ—Ç –º–µ—Å—Ç–æ –ª–æ–∫–∞–ª—å–Ω–æ
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π search-replace
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞

---

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –†–∞–∑–º–µ—Ä –ë–î
- –î–ª—è –±–æ–ª—å—à–∏—Ö –ë–î (>500 MB) –ø—Ä–æ—Ü–µ—Å—Å –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç
- –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ `/tmp/` –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
- –ü–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞ —Ñ–∞–π–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è

### SSH –¥–æ—Å—Ç—É–ø
- –¢—Ä–µ–±—É–µ—Ç—Å—è SSH –¥–æ—Å—Ç—É–ø –∫ –æ–±–æ–∏–º —Å–µ—Ä–≤–µ—Ä–∞–º
- WP-CLI –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ –æ–±–æ–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ `config.sh`

### –î–æ–º–µ–Ω—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–Ω—è–µ—Ç—Å—è URL
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `--skip-columns=guid` (–Ω–µ –º–µ–Ω—è–µ—Ç GUID –ø–æ—Å—Ç–æ–≤)
- –û–ø—Ü–∏—è `--precise` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∑–∞–º–µ–Ω—ã

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ DEV
../test-ssh-connection.sh dev

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PROD
../test-ssh-connection.sh prod
```

### –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
```bash
# –ù–∞–π—Ç–∏ backup –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh user@server "ls -lh /path/to/backups/"

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å backup
ssh user@server "cd /path/to/wp && wp db import ../backups/backup-FILE.sql.gz"
```

### –õ–æ–≥–∏
–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ stdout, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:
```bash
./db-sync.sh sync prod dev 2>&1 | tee sync-log.txt
```

---

## ÔøΩÔøΩ –ò—Ç–æ–≥–æ

–ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ `sync` –¥–µ–ª–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –ë–î –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏:
- **–ü—Ä–æ—â–µ**: 1 –∫–æ–º–∞–Ω–¥–∞ –≤–º–µ—Å—Ç–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö
- **–ë—ã—Å—Ç—Ä–µ–µ**: –ø—Ä—è–º–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –±–µ–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è
- **–ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ backups –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- **–£–¥–æ–±–Ω–µ–µ**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–º–µ–Ω–∞ –¥–æ–º–µ–Ω–æ–≤ –∏ –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DEV –∏–∑ PROD! üöÄ
