<!-- Database Management Scripts -->

# üóÑÔ∏è –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö WordPress —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
- ‚úÖ –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –æ–∫—Ä—É–∂–µ–Ω–∏—è–º–∏
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º
- ‚úÖ Snapshots –ë–î –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ç–æ–∫
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–º–µ–Ω–∞ –¥–æ–º–µ–Ω–æ–≤
- ‚úÖ Git hooks –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –ë–î –ø–æ –≤–µ—Ç–∫–∞–º

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
deployment-scripts/database/
‚îú‚îÄ‚îÄ db-snapshot.sh           # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ snapshots
‚îú‚îÄ‚îÄ db-sync.sh              # –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ db-migrate.sh           # –°–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π
‚îú‚îÄ‚îÄ db-create-migration.sh  # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –º–∏–≥—Ä–∞—Ü–∏–π
‚îú‚îÄ‚îÄ install-hooks.sh        # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Git hooks
‚îú‚îÄ‚îÄ git-hooks/
‚îÇ   ‚îî‚îÄ‚îÄ post-checkout       # –ê–≤—Ç–æ–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ë–î –ø—Ä–∏ checkout
‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îú‚îÄ‚îÄ 001_example.sql     # –§–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ .applied.json       # –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
‚îî‚îÄ‚îÄ utils/
    ‚îî‚îÄ‚îÄ search-replace.sh   # –ó–∞–º–µ–Ω–∞ –¥–æ–º–µ–Ω–æ–≤
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Git Hooks (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
cd www/deployment-scripts/database
./install-hooks.sh
```

–≠—Ç–æ –≤–∫–ª—é—á–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ë–î –ø—Ä–∏ —Å–º–µ–Ω–µ –≤–µ—Ç–æ–∫.

### 2. –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
# –°–æ–∑–¥–∞—Ç—å snapshot —Ç–µ–∫—É—â–µ–π –ë–î
./db-snapshot.sh create "initial"

# –ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –ë–î —Å –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
./db-sync.sh pull prod
```

---

## üìã –ö–æ–º–∞–Ω–¥—ã

### üîÑ –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (`db-sync.sh`)

#### –ó–∞–≥—Ä—É–∑–∏—Ç—å –ë–î —Å —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –° –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
./db-sync.sh pull prod

# –° –¥–µ–≤–∞
./db-sync.sh pull dev
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –°–æ–∑–¥–∞–µ—Ç snapshot —Ç–µ–∫—É—â–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
2. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –ë–î —Å —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
3. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î
4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–Ω—è–µ—Ç –¥–æ–º–µ–Ω—ã
5. –û—á–∏—â–∞–µ—Ç –∫—ç—à WordPress

#### –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ë–î –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω (Initial Deploy)

```bash
./db-sync.sh push prod
```

‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï**: –≠—Ç–æ –∑–∞–º–µ–Ω–∏—Ç –ë–î –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–ª—è initial deploy.

---

### üì∏ Snapshots (`db-snapshot.sh`)

#### –°–æ–∑–¥–∞—Ç—å snapshot

```bash
# –° –æ–ø–∏—Å–∞–Ω–∏–µ–º
./db-snapshot.sh create "before big changes"

# –ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è
./db-snapshot.sh create
```

#### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ snapshots

```bash
./db-snapshot.sh list
```

–í—ã–≤–æ–¥:
```
üìã –°–ø–∏—Å–æ–∫ snapshots:

‚ñ† main (—Ç–µ–∫—É—â–∞—è)
  ‚îú‚îÄ main_20251029_153022 (12M) - initial
  ‚îú‚îÄ main_20251029_154511 (12M)

‚ñ† feature-blog
  ‚îú‚îÄ feature-blog_20251029_160133 (11M) - before migration
```

#### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å snapshot

```bash
# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π snapshot
./db-snapshot.sh restore main_20251029_153022

# –ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–ª—è —Ç–µ–∫—É—â–µ–π –≤–µ—Ç–∫–∏
./db-snapshot.sh restore latest
```

#### –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ snapshots

```bash
./db-snapshot.sh cleanup
```

---

### üóÑÔ∏è –ú–∏–≥—Ä–∞—Ü–∏–∏ (`db-migrate.sh`)

#### –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é

```bash
./db-create-migration.sh "add products table"
```

–°–æ–∑–¥–∞—Å—Ç —Ñ–∞–π–ª: `migrations/001_add_products_table.sql`

#### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

–û—Ç–∫—Ä–æ–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –∏ –¥–æ–±–∞–≤—å—Ç–µ SQL:

```sql
-- migrations/001_add_products_table.sql

CREATE TABLE IF NOT EXISTS wp_products (
    id bigint(20) unsigned NOT NULL AUTO_INCREMENT,
    name varchar(255) NOT NULL,
    price decimal(10,2) NOT NULL,
    created_at datetime DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
./db-migrate.sh apply local

# –ù–∞ DEV
./db-migrate.sh apply dev

# –ù–∞ PROD
./db-migrate.sh apply prod
```

#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –î–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
./db-migrate.sh status local
./db-migrate.sh status dev
./db-migrate.sh status prod

# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π
./db-migrate.sh list
```

–í—ã–≤–æ–¥:
```
001 add products table
   ‚îú‚îÄ Local: [‚úì]  Dev: [‚úì]  Prod: [ ]
   ‚îî‚îÄ –§–∞–π–ª: 001_add_products_table.sql

002 add category column
   ‚îú‚îÄ Local: [‚úì]  Dev: [ ]  Prod: [ ]
   ‚îî‚îÄ –§–∞–π–ª: 002_add_category_column.sql
```

---

### üîç –ó–∞–º–µ–Ω–∞ –¥–æ–º–µ–Ω–æ–≤ (`utils/search-replace.sh`)

```bash
# –ó–∞–º–µ–Ω–∏—Ç—å –¥–æ–º–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ
./utils/search-replace.sh \
    "http://wordpresstest.ru.xsph.ru" \
    "http://localhost" \
    local

# –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
./utils/search-replace.sh \
    "http://localhost" \
    "http://wordpresstest.ru.xsph.ru" \
    prod
```

---

## üîÄ –†–∞–±–æ—Ç–∞ —Å –≤–µ—Ç–∫–∞–º–∏

### –° —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ Git Hooks (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

```bash
# –í—ã –Ω–∞ –≤–µ—Ç–∫–µ main
git checkout feature/blog
# ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ë–î main, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ë–î feature/blog

# –†–∞–±–æ—Ç–∞–µ—Ç–µ –Ω–∞–¥ —Ñ–∏—á–µ–π...

git checkout main
# ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ë–î feature/blog, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ë–î main
```

### –ë–µ–∑ Git Hooks (–≤—Ä—É—á–Ω—É—é)

```bash
# –°–æ–∑–¥–∞—Ç—å snapshot –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º
./db-snapshot.sh create "before switching to feature"

# –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è
git checkout feature/blog

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å snapshot –¥–ª—è –Ω–æ–≤–æ–π –≤–µ—Ç–∫–∏
./db-snapshot.sh restore latest
# –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–µ–∂—É—é –ë–î —Å –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
./db-sync.sh pull prod
```

---

## üìñ –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–æ–≤–∞—è —Ñ–∏—á–∞ —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –ë–î

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É
git checkout -b feature/new-products

# 2. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
./db-create-migration.sh "add products table"

# 3. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å migrations/001_add_products_table.sql

# 4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
./db-migrate.sh apply local

# 5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

# 6. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å
git add migrations/001_add_products_table.sql
git commit -m "Add products table migration"

# 7. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞ DEV
./db-migrate.sh apply dev

# 8. –ü–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤ - –Ω–∞ PROD
./db-migrate.sh apply prod
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤

```bash
# –ó–∞–≥—Ä—É–∑–∏—Ç—å –ë–î —Å –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
./db-sync.sh pull prod
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –°–ª–æ–º–∞–ª–∏ –±–∞–∑—É, –Ω—É–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ snapshots
./db-snapshot.sh list

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π
./db-snapshot.sh restore latest

# –ò–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π
./db-snapshot.sh restore main_20251029_153022
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: Initial Deploy

```bash
# 1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ª–æ–∫–∞–ª—å–Ω–∞—è –ë–î –≥–æ—Ç–æ–≤–∞
./db-snapshot.sh list

# 2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω
./db-sync.sh push prod
# ‚ö†Ô∏è –ü–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–≤–µ—Å—Ç–∏: REPLACE DATABASE

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∞–π—Ç
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ñ–∏—á–∞–º–∏

```bash
# –†–∞–±–æ—Ç–∞–µ—Ç–µ –Ω–∞–¥ feature/blog
# ... –¥–µ–ª–∞–µ—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î ...

# –ù—É–∂–Ω–æ —Å—Ä–æ—á–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ feature/shop
git checkout feature/shop
# ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –ë–î (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω hook)

# –†–∞–±–æ—Ç–∞–µ—Ç–µ –Ω–∞–¥ shop
# ... –¥–µ–ª–∞–µ—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è ...

# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç–µ—Å—å –∫ blog
git checkout feature/blog
# ‚Üí –ë–î –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é feature/blog
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `deployment-scripts/config.sh`:

```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î (Docker)
LOCAL_DB_NAME="wordpress"
LOCAL_DB_USER="wordpress"
LOCAL_DB_PASS="wordpress"
LOCAL_DB_HOST="localhost"
LOCAL_DB_PORT="3306"
LOCAL_DB_CONTAINER="wordpress_mysql"
LOCAL_SITE_URL="http://localhost"

# Snapshots
LOCAL_SNAPSHOT_DIR="${LOCAL_BACKUP_DIR}/snapshots"
SNAPSHOT_KEEP_COUNT="3"  # –°–∫–æ–ª—å–∫–æ —Ö—Ä–∞–Ω–∏—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–π –≤–µ—Ç–∫–∏
SNAPSHOT_AUTO_SWITCH="true"  # –ê–≤—Ç–æ–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ git checkout
```

---

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Docker** —Å –∑–∞–ø—É—â–µ–Ω–Ω—ã–º MySQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º
- **WP-CLI** —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- **jq** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JSON (–æ–±—ã—á–Ω–æ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ macOS)
- **SSH –¥–æ—Å—Ç—É–ø** –∫ —É–¥–∞–ª–µ–Ω–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–∞–º
- **Git** –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π

---

## üí° –°–æ–≤–µ—Ç—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ú–∏–≥—Ä–∞—Ü–∏–∏

‚úÖ **DO:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `IF NOT EXISTS` –¥–ª—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- –ö–æ–º–º–∏—Ç—å—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ Git
- –ü—Ä–∏–º–µ–Ω—è–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ: local ‚Üí dev ‚Üí prod
- –î–æ–±–∞–≤–ª—è–π—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ —Å–ª–æ–∂–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏—è—Ö

‚ùå **DON'T:**
- –ù–µ –∏–∑–º–µ–Ω—è–π—Ç–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (—Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –Ω–æ–≤—ã–µ)
- –ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–π—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ DEV
- –ù–µ –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ MySQL

### Snapshots

‚úÖ **DO:**
- –°–æ–∑–¥–∞–≤–∞–π—Ç–µ snapshot –ø–µ—Ä–µ–¥ –±–æ–ª—å—à–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞
- –†–µ–≥—É–ª—è—Ä–Ω–æ —á–∏—Å—Ç–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ snapshots

‚ùå **DON'T:**
- –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ snapshots (–∑–∞–Ω–∏–º–∞—é—Ç –º–µ—Å—Ç–æ)
- –ù–µ –ø–æ–ª–∞–≥–∞–π—Ç–µ—Å—å —Ç–æ–ª—å–∫–æ –Ω–∞ snapshots (–¥–µ–ª–∞–π—Ç–µ –ø–æ–ª–Ω—ã–µ backup)

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

‚úÖ **DO:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `pull` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –¥–æ–º–µ–Ω—ã –ø–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

‚ùå **DON'T:**
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `push prod` –ø–æ—Å–ª–µ initial deploy
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

---

## üêõ Troubleshooting

### Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker ps -a

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é
docker start wordpress_mysql

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker logs wordpress_mysql
```

### WP-CLI –Ω–µ –Ω–∞–π–¥–µ–Ω

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å WP-CLI –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker exec wordpress_mysql wp --info

# –ï—Å–ª–∏ –Ω–µ—Ç - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ Dockerfile
```

### –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å SQL
cat migrations/001_example.sql

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
docker exec -i wordpress_mysql \
    mysql -u wordpress -pwordpress wordpress \
    < migrations/001_example.sql
```

### Snapshot –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª
ls -lh /Users/adoknov/work/maslovka/backups/snapshots/

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é
gunzip -c snapshot.sql.gz | docker exec -i wordpress_mysql \
    mysql -u wordpress -pwordpress wordpress
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ

- **Snapshots**: `/Users/adoknov/work/maslovka/www/backups/snapshots/`
- **–ú–∏–≥—Ä–∞—Ü–∏–∏**: `www/deployment-scripts/database/migrations/`
- **–õ–æ–≥–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è**: `www/deployment-scripts/database/migrations/.applied.json`

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚ö†Ô∏è `config.sh` –≤ `.gitignore` - —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–∞—Ä–æ–ª–∏
- ‚ö†Ô∏è Snapshots —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ - –Ω–µ –∫–æ–º–º–∏—Ç—è—Ç—Å—è
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤ Git - –±–µ–∑ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

## üÜò –ü–æ–ª—É—á–∏—Ç—å –ø–æ–º–æ—â—å

```bash
# –ü–æ–º–æ—â—å –ø–æ –∫–æ–º–∞–Ω–¥–∞–º
./db-snapshot.sh help
./db-sync.sh help
./db-migrate.sh help
./db-create-migration.sh help
```

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ß–∞—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ wordpress-docker-setup

